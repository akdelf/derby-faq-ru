FAQ по Derby 0.6 (на русском)
=====================

В этом репозитории я буду собирать часто задаваемые вопросы, а так же всевозможные тонкости по [derbyjs](http://derbyjs.com)

### Как я могу добавить что-то в FAQ?

Напишите мне @zag2art сообщаение через гитхаб или на почту (zag2art@gmail.com), а лучше сделайте форк, добавьте информацию и посылайте пулл-реквест.

### У меня есть вопрос, ответа я не знаю, но думаю всем бы было полезно узнать его

Оформляйте issue в данном репозитории - постараемся ответить, и если посчитаем вопрос достаточно интересным и общим - сами добавим его в FAQ.

## Запросы

### Как сделать реактинвый запрос к количеству элементов в коллекции (сами элементы мне не нужны)?

```js
  var topicsCount = model.query('topics', {
    $count: true,
    $query: {
      active: true
    }
  });
  
  model.subscribe(tipicsCount, function(){
    topicsCount.refExtra('_page.topicsCount');
    
    // ...
  });
```

### Как подписаться на определенные элементы коллекции (у меня уже есть реактивный список id, нужных элементов)?

### Как получить не сами элементы коллекции, а только их id?
```js
  var query = model.query('topics');
  
  model.subscribe(query, function(){
    query.refIds('_page.topicIds');
  });
```  
  
  Но необходимо учитывать, что сама коллекция topics в данном случае будет копироваться в браузер, чтобы этого избежать используйте проекции. В серверной части derby, в server.js определите проекцию для коллекции topics:
```  
  store.shareClient.backend.addProjection("topicIds", "topics", "json0", {id: true});
```  
  Далее с проекцией можно работать, как с обычной коллекцией.
```js  
  var query = model.query('topicsIds');
  
  model.subscribe(query, function(){
    query.refIds('_page.topicIds');
  });
```  

## Компоненты

### Как в шаблонах компонент получить доступ к корневой области видимости модели?

Как известно, в компонентах своя, изолированная область видимости, поэтому для доступа к корню необходимо использовать префикс #root, например:
```html
<ul>
  {{each #root._page.topics as #topic}}
    <!-- ... -->
  {{/}}
<ul>
```

### Как в коде компонент получить доступ к корневой области видимости модели?

Как известно, в компонентах своя, изолированная область видимости, поэтому, чтобы обратиться к корневой модели, вместо model, здесь необходимо использовать model.root. Например:
```js
function MyComponent() {}

MyComponent.prototype.init = function(model){
  // model.get('_page.topics') работать не будет
  var topics = model.root.get('_page.topics');
  // ...
  
}

MyComponent.prototype.onClick = function(event, element){
  var topics = this.model.root.get('_page.topics');
  // ...
  
}
```

## Модель

### Мне не нужны все поля коллекции в браузере, как получать только определенные поля (проекцию коллекции)?

В серверной части derby-приложения прописываются все проекции:
```js
store.shareClient.backend.addProjection("topic_headers", "topics", "json0", {id: true, header: true, autor: true, createAt: true});
store.shareClient.backend.addProjection("users", "auth", "json0", {id: true, username: true, email: true});
```
Далее с проекциями users и topic_headers в derby-приложении можно работать, как с обычными коллекциями.
```js
model.subscribe('users' function(){
  model.ref('_page.users', 'users');
  // ...
});
```
При создании проекций обратите внимание: поле id обязательно, пока поддерживается только белый список полей (перечисляем только поля, которые должны попасть в проекцию), так же поддерживется пока только возможность задавать поля первого уровня вложенности.

## База данных

### Говорят появилась возможность обходится без redis-а, используя только mongodb, как это сделать?

В серверной части derby-приложения в момент создания объекта store необходимо прописать только mongodb-данные:
```js
  var store = derby.createStore({
    db: liveDbMongo(mongoUrl + '?auto_reconnect', {safe: true})
  });
```

Но стоит учесть то, что redis необходим, если вы планируете горизонтальное масштабирование (запускать несколько derby-серверов параллельно). 

## Въюхи

### Как вставить в шаблон неэкранированный html или текст?

Необходимо использовать unescaped модификатор, например:
```html
<header>
  {{topic.header}}
<header>

<!-- topic.unescapedTitle сделал только для примера, не знаю зачем такое может понадобиться -->
<article title="{{unesqaped topic.unescapedTitle}}">
  {{unesqaped topic.html}}
</article>
```

Учитывайте то, что это - потенциальная дыра в безопасности. Ваши данные должны быть полностью отчищены от опасных тегов, данные для атрибутов должны быть экранированы. В общем, прежде чем использовать такое, убедитесь, что вы понимаете что делаете.

### Как в шаблоне определенный блок сделать нереактивным (чтобы он не обновлялся сразу при изменении данных в модели)?

Во-первых стоит сказать о том, что если нам в приложении вообще не нужна реактивность, то вместо подписки на данные нам стоит просто запрашивать их текущее состояние - вместо model.subscribe делать model.fetch.

  // Так данные будут реактивно обновляться
  model.subscribe('topics', function(){
    // ...
  });
  
  // А так не будут
  model.fetch('topics', function(){
    // ...
  });
  
Важно понимать, что здесь мы пока говорим только о модели и только об обновлениях, приходящих с сервера. Важно, что сделав fetch, если мы что-то добавили в коллекцию, использовав model.add - наши данные вполне себе попадут на сервер в б.д., с другой стороны, если данные в коллекцию добавил кто-то другой - они к нам не придут.
  
Далее, если говорить о html-шаблонах, то, по умолчанию, все привязки там реактивные  



### Как в шаблоне сделать так, чтобы в определенный момент обновился нереактивный блок?

### Как привязать реактивную переменную к элементу select?

### Как привязать реактивную переменную к элементу input type=radio?

### Как привязать реактивную переменную к элементу textarea?

## Модули

### Как к derby подключить шаблонизатор jade?

### Какой модуль использовать для авторизации в derby?

### Как подключать клиентские скрипты к derby-приложение, например jquery?

## Написание модулей

### Как проверить, что код в derby-приложении выполняется на клиенте/на сервере?

### Как сделать require модуля в derby-приложении, код которого будет выполняться только на сервере?
